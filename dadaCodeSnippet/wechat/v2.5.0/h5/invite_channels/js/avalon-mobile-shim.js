!function(a,b){"object"==typeof module&&"object"==typeof module.exports?module.exports=a.document?b(a,!0):function(a){if(!a.document)throw new Error("Avalon requires a window with a document");return b(a)}:b(a)}("undefined"!=typeof window?window:this,function(a,b){function g(){avalon.config.debug&&console.log.apply(console,arguments)}function h(){return Object.create(null)}function y(){}function z(a,b){var c,d,e,f;for("string"==typeof a&&(a=a.match(k)||[]),c={},d=void 0!==b?b:1,e=0,f=a.length;f>e;e++)c[a[e]]=d;return c}function B(){if(a.VBArray){var b=document.documentMode;return b?b:a.XMLHttpRequest?7:6}return 0/0}function H(a){if(a&&"object"==typeof a){var b=a.length,c=q.call(a);if(/(Array|List|Collection|Map|Arguments)\]$/.test(c))return!0;if("[object Object]"===c&&b===b>>>0)return!0}return!1}function L(a,b){var c,f,e,g;if(a&&a.childNodes)for(c=a.childNodes,e=0;f=c[e++];)f.tagName&&(g=d.createElementNS(J,f.tagName.toLowerCase()),r.forEach.call(f.attributes,function(a){g.setAttribute(a.name,a.value)}),L(f,g),b.appendChild(g))}function N(a){var b,c;for(b in a)p.call(a,b)&&(c=a[b],"function"==typeof N.plugins[b]?N.plugins[b](c):"object"==typeof N[b]?avalon.mix(N[b],c):N[b]=c);return this}function U(a){return(a+"").replace(T,"\\$&")}function _(a,b,c){var d,e,f,g,i,j,k,m,n,o;if(Array.isArray(a))return d=a.concat(),a.length=0,e=mb(a),e.pushArray(d),e;if(!a||a.$id&&a.$events||a.nodeName&&a.nodeType>0)return a;for(f=Array.isArray(a.$skipArray)?a.$skipArray:[],f.$special=b||h(),g={},c=c||{},i=h(),j=h(),k=[],$.forEach(function(b){delete a[b]}),m=Object.keys(a),m.forEach(function(b,d){var g,e=a[b];c[b]=e,kb(b,e,f)&&(i[b]=[],g=avalon.type(e),"object"===g&&D(e.get)&&Object.keys(e).length<=2?(d=db(b,e),k.push(d)):d=l.test(g)?eb(b,e,g,i[b],c):cb(b,e),j[b]=d)}),g=Object.defineProperties(g,lb(j)),n=0;n<m.length;n++)o=m[n],j[o]||(g[o]=a[o]);ab(g,"$id",A()),ab(g,"$model",c),ab(g,"$events",i),ab(g,"hasOwnProperty",function(a){return a in this.$model});for(n in Y)ab(g,n,Y[n]);return g.$reinitialize=function(){k.forEach(function(a){delete a._value,delete a.oldArgs,a.digest=function(){a.call(g)},sb.begin({callback:function(b,c){var e,d=c._name;c!==a&&(e=b.$events[d],a.vm=g,ub(e,a.digest))}});try{a.get.call(g)}finally{sb.end()}})},g.$reinitialize(),g}function ab(a,b,c){Object.defineProperty(a,b,{value:c,writable:!0,enumerable:!1,configurable:!0})}function bb(a){var c,d,b=Object.keys(a);for(c=0;c<$.length;c++)d=b.indexOf($[c]),-1!==d&&b.splice(d,1);return b}function cb(a,b){function c(a){var b=c._value;return arguments.length>0?(j||jb(a,b)||(c.updateValue(this,a),c.notify(this,a,b)),this):(sb.collectDependency(this,c),b)}return ib(c,a),c._value=b,c}function db(a,b){function c(b){var f,g,d=c._value,e="_value"in c;return arguments.length>0?j?this:("function"==typeof c.set&&c.oldArgs!==b&&(c.oldArgs=b,f=this.$events,g=f[a],f[a]=[],c.set.call(this,b),f[a]=g,b=c.get.call(this),b!==d&&(c.updateValue(this,b),c.notify(this,b,d))),this):(b=c.get.call(this),c.updateValue(this,b),e&&d!==b&&c.notify(this,b,d),b)}return c.set=b.set,c.get=b.get,ib(c,a),c}function eb(a,b,c,d,e){function f(b){var g,h,k,l,m,n,o,q,d=f._value,e=f._vmodel;if(arguments.length>0){if(j)return this;if("array"===c){for(g=e,h=b,k=g.length,l=h.length,g.$lock=!0,k>l?g.splice(l,k-l):l>k&&g.push.apply(g,h.slice(k)),m=Math.min(k,l),n=0;m>n;n++)g.set(n,h[n]);delete g.$lock,g._fire("set")}else if("object"===c){b=b.$model?b.$model:b,o=this.$events[a]||[],q=avalon.mix(!0,{},b);for(n in e)e.hasOwnProperty(n)&&p.call(q,n)&&(e[n]=q[n]);e=f._vmodel=_(b),e.$events[i]=o,o.length&&o.forEach(function(a){a.type&&(a.rollback&&a.rollback(),F[a.type](a,a.vmodels))})}return f.updateValue(this,e.$model),f.notify(this,this._value,d),this}return sb.collectDependency(this,f),e}ib(f,a),e[a]=Array.isArray(b)?b:e[a]||{};var g=f._vmodel=_(b,0,e[a]);return g.$events[i]=d,f}function fb(a,b){a.$model[this._name]=this._value=b}function hb(a,b,c){var d=this._name,e=a.$events[d];e&&(vb(e),Y.$fire.call(a,d,b,c))}function ib(a,b){a._name=b,a.updateValue=fb,a.notify=hb}function kb(a,b,c){if(D(b)||b&&b.nodeName&&b.nodeType>0)return!1;if(-1!==c.indexOf(a))return!1;var d=c.$special;return a&&"$"===a.charAt(0)&&!d[a]?!1:!0}function mb(a){var c,b=[];b.$id=A(),b.$model=a,b.$events={},b.$events[i]=[],b._=_({length:a.length}),b._.$watch("length",function(a,c){b.$fire("length",a,c)});for(c in Y)b[c]=Y[c];return avalon.mix(b,pb),b}function nb(a,b,c,d,e,f,g){for(var j,k,h=this.length,i=2;--i;){switch(a){case"add":j=this.$model.slice(b,b+c).map(function(a){return l.test(avalon.type(a))?a.$id?a:_(a,0,a):a}),ob.apply(this,[b,0].concat(j)),this._fire("add",b,c);break;case"del":k=this._splice(b,c),this._fire("del",b,c)}e&&(a=e,b=f,c=g,i=2,e=0)}return this._fire("index",d),this.length!==h&&(this._.length=this.length),k}function rb(a,b){var d,e,f,c={};for(d=0,e=b.length;e>d;d++)c[d]=a[d],f=b[d],f in c?(a[d]=c[f],delete c[f]):a[d]=a[f]}function ub(a,b){b.oneTime||a&&avalon.Array.ensure(a,b)&&b.element&&(Bb(b,a),new Date-yb>444&&Db())}function vb(a){var b,d,c,e,f,g;if(a&&a.length)for(new Date-yb>444&&"object"==typeof a[0]&&Db(),b=s.call(arguments,1),c=a.length;d=a[--c];)if(e=d.element,e&&e.parentNode)try{f=d.evaluator,d.$repeat?d.handler.apply(d,b):"$repeat"in d||!f?F[d.type](d,d.vmodels):"on"!==d.type&&(g=f.apply(0,d.args||[]),d.handler(g,e,d))}catch(h){console.log(h)}}function Ab(a,b){return a.uuid||b||(a.uuid=++wb),a.uuid}function Bb(a,b){var c=a.element;a.uuid||(a.uuid=1!==c.nodeType?a.type+Ab(c.parentNode)+"-"+ ++wb:a.name+"-"+Ab(c)),xb[a.uuid]||(a.list=b,a.i=~~a.i,xb[a.uuid]="__",xb.push(a))}function Db(a){for(var b=Cb||xb.length,c=0;a=xb[--b];)if(a.i<7){if(null===a.element){xb.splice(b,1),a.list&&(avalon.Array.remove(a.list,a),delete xb[a.uuid]);continue}if(a.element&&Fb(a.element)){if(xb.splice(b,1),avalon.Array.remove(a.list,a),Eb(a),c++>500){Cb=b;break}continue}a.i++,7===a.i&&(a.i=14)}else a.i--;yb=new Date}function Eb(a){delete xb[a.uuid],a.element=null,a.rollback&&a.rollback();for(var b in a)a[b]=null}function Fb(a){try{a.parentNode.nodeType}catch(c){return!0}return a.ifRemove&&!u.contains(a.ifRemove)&&f===a.parentNode?(a.parentNode&&a.parentNode.removeChild(a),!0):a.msRetain?0:1===a.nodeType?!u.contains(a):!avalon.contains(u,a)}function Mb(a){return a.replace(/([a-z\d])([A-Z]+)/g,"$1-$2").toLowerCase()}function Nb(a){return a.indexOf("-")<0&&a.indexOf("_")<0?a:a.replace(/[-_][^-_]/g,function(a){return a.charAt(1).toUpperCase()})}function Pb(a){try{if("object"==typeof a)return a;a="true"===a?!0:"false"===a?!1:"null"===a?null:+a+""===a?+a:Ob.test(a)?JSON.parse(a):a}catch(b){}return a}function Qb(a){return a.window&&a.document?a:9===a.nodeType?a.defaultView:!1}function Wb(a,b){var c,d,e,f;if(a.offsetWidth<=0){if(c=getComputedStyle(a,null),Vb.test(c["display"])){d={node:a};for(e in Ub)d[e]=c[e],a.style[e]=Ub[e];b.push(d)}f=a.parentNode,f&&1===f.nodeType&&Wb(f,b)}}function Xb(a){var b=a.tagName.toLowerCase();return"input"===b&&/checkbox|radio/.test(a.type)?"checked":b}function gc(a,b,c,d){var h,g,e=[],f=" = "+c+".";for(g=a.length;h=a[--g];)b.hasOwnProperty(h)&&(e.push(h+f+h),d.vars.push(h),"duplex"===d.type&&(a.get=c+"."+h),a.splice(g,1));return e}function hc(a){var d,e,f,b=[],c={};for(d=0;d<a.length;d++)e=a[d],f=e&&"string"==typeof e.$id?e.$id:e,c[f]||(c[f]=b.push(e));return b}function qc(a,b){return b=b.replace(lc,"").replace(mc,function(){return"],|"}).replace(nc,function(a,b){return"["+Zb(b)}).replace(oc,function(){return'"],["'}).replace(pc,function(){return'",'})+"]","return this.filters.$filter("+a+", "+b+")"}function rc(a,b,d){var n,o,p,q,s,t,u,v,e=d.type,f=d.filters||"",h=b.map(function(a){return String(a.$id).replace(kc,"$1")})+a+e+f,i=fc(a).concat(),j=[],k=[],l=[],m="";for(b=hc(b),d.vars=[],n=0,o=b.length;o>n;n++)i.length&&(p="vm"+c+"_"+n,k.push(p),l.push(b[n]),j.push.apply(j,gc(i,b[n],p,d)));if(j.length||"duplex"!==e){if("duplex"!==e&&(a.indexOf("||")>-1||a.indexOf("&&")>-1)&&d.vars.forEach(function(b){var c=new RegExp("\\b"+b+"(?:\\.\\w+|\\[\\w+\\])+","ig");a=a.replace(c,function(c,d){var h,i,k,e=c.charAt(b.length),f=a.slice(d+c.length),g=/^\s*\(/.test(f);return"."===e||"["===e||g?(h="var"+String(Math.random()).replace(/^0\./,""),g?(i=c.split("."),i.length>2?(k=i.pop(),j.push(h+" = "+i.join(".")),h+"."+k):c):(j.push(h+" = "+c),h)):c})}),d.args=l,delete d.vars,q=ic.get(h))return d.evaluator=q,void 0;if(m=j.join(", "),m&&(m="var "+m),/\S/.test(f)){if(!/text|html/.test(d.type))throw Error("ms-"+d.type+"不支持过滤器");a="\nvar ret"+c+" = "+a+";\r\n",a+=qc("ret"+c,f);try{q=Function.apply(y,k.concat("'use strict';\n"+m+a)),d.evaluator=ic.put(h,function(){return q.apply(avalon,arguments)})}catch(r){g("debug: parse error,"+r.message)}return i=j=k=null,void 0}if("duplex"===e){s="'use strict';\nreturn function(vvv){\n    "+m+";\n    if(!arguments.length){\n        return "+a+"\n  }\n "+(jc.test(a)?a:i.get)+"= vvv;\n} ";try{q=Function.apply(y,k.concat(s)),d.evaluator=ic.put(h,q)}catch(r){g("debug: parse error,"+r.message)}return i=j=k=null,void 0}"on"===e?(-1===a.indexOf("(")?a+=".call(this, $event)":a=a.replace("(",".call(this,"),k.push("$event"),a="\nreturn "+a+";",t=a.lastIndexOf("\nreturn"),u=a.slice(0,t),v=a.slice(t),a=u+"\n"+v):a="\nreturn "+a+";";try{q=Function.apply(y,k.concat("'use strict';\n"+m+a)),d.evaluator=ic.put(h,q)}catch(r){g("debug: parse error,"+r.message)}i=j=k=null}}function sc(a){var c,b=Q.test(a);return b?(c=Tc(a),1===c.length?c[0].value:c.map(function(a){return a.expr?"("+a.value+")":Zb(a.value)}).join(" + ")):a}function tc(a,b,c,d){a=a||"",rc(a,b,c),c.evaluator&&!d&&(c.handler=G[c.handlerName||c.type],avalon.injectBinding(c))}function vc(a,b,c){var d=setTimeout(function(){var e=a.innerHTML;clearTimeout(d),e===c?b():vc(a,b,e)})}function wc(a,b){var c=a.getAttribute("avalonctrl")||b.$id;a.setAttribute("avalonctrl",c),b.$events.expr=a.tagName+'[avalonctrl="'+c+'"]'}function yc(a,b){for(var d,c=0;d=a[c++];)d.vmodels=b,F[d.type](d,b),d.evaluator&&d.element&&1===d.element.nodeType&&d.element.removeAttribute(d.name);a.length=0}function Fc(a,b){return a.priority-b.priority}function Gc(a,b,c){var e,f,i,j,k,m,l,n,o,p,q,r,s,t,u,v,w,d=!0;if(b.length){for(e=a.attributes,f=[],i=[],j={},k=h(),l=0;m=e[l++];)if(m.specified&&(c=m.name.match(Bc))){if(n=c[1],o=c[2]||"",p=m.value,q=m.name,j[q])continue;j[q]=1,Dc[n]?(o=n,n="on"):Ec[n]&&("enabled"===n&&(g("warning!ms-enabled或ms-attr-enabled已经被废弃"),n="disabled",p="!("+p+")"),o=n,n="attr",q="ms-"+n+"-"+o,i.push([m.name,q,p])),k[q]=p,"function"==typeof F[n]&&(r=p.replace(Ac,""),s=p!==r,t={type:n,param:o,element:a,name:q,value:r,oneTime:s,priority:(Cc[n]||10*n.charCodeAt(0))+(Number(o.replace(/\D/g,""))||0)},"html"===n||"text"===n?(u=Sc(p),avalon.mix(t,u),t.filters=t.filters.replace(Mc,function(){return t.type="html",t.group=1,""})):"duplex"===n?v=q:"ms-if-loop"===q&&(t.priority+=100),f.push(t),"widget"===n&&(a.msData=a.msData||k))}if(f.length){for(f.sort(Fc),i.forEach(function(b){g("warning!请改用"+b[1]+"代替"+b[0]+"!"),a.removeAttribute(b[0]),a.setAttribute(b[1],b[2])}),w=a.type,w&&v&&k["ms-attr-value"]&&"text"===a.type&&g("warning!"+w+"控件不能同时定义ms-attr-value与"+v),l=0;t=f[l];l++){if(n=t.type,Hc.test(n))return yc(f.slice(0,l+1),b);d&&(d=!Ic.test(n))}yc(f,b)}}d&&!uc[a.tagName]&&S.test(a.innerHTML+a.textContent)&&(zc&&zc(a),Jc(a,b))}function Jc(a,b){var c=avalon.slice(a.childNodes);Kc(c,b)}function Kc(a,b){for(var d,c=0;d=a[c++];)switch(d.nodeType){case 1:Lc(d,b),d.msCallback&&(d.msCallback(),d.msCallback=void 0);break;case 3:Q.test(d.nodeValue)&&Uc(d,b,c)}}function Lc(a,b,c){var g,d=a.getAttribute("ms-skip"),e=a.getAttributeNode("ms-important"),f=a.getAttributeNode("ms-controller");if("string"!=typeof d){if(c=e||f){if(g=avalon.vmodels[c.value],!g)return;b=c===e?[g]:[g].concat(b),a.removeAttribute(c.name),a.classList.remove(c.name),wc(a,g)}Gc(a,b)}}function Sc(a){var b,c;return a.indexOf("|")>0&&(b=a.replace(Qc,function(a){return Array(a.length+1).join("1")}),c=b.replace(Nc,"ᄢ㍄").indexOf("|"),c>-1)?{filters:a.slice(c),value:a.slice(0,c),expr:!0}:{value:a,filters:"",expr:!0}}function Tc(a){for(var c,e,b=[],d=0;;){if(e=a.indexOf(O,d),-1===e)break;if(c=a.slice(d,e),c&&b.push({value:c,filters:"",expr:!1}),d=e+O.length,e=a.indexOf(P,d),-1===e)break;c=a.slice(d,e),c&&b.push(Sc(c.replace(Rc,""))),d=e+P.length}return c=a.slice(d),c&&b.push({value:c,expr:!1,filters:""}),b}function Uc(a,b){var g,f,h,c=[],e=Tc(a.data);if(e.length){for(f=0;g=e[f++];)h=d.createTextNode(g.value),g.expr&&(g.value=g.value.replace(Ac,function(){return g.oneTime=!0,""}),g.type="text",g.element=h,g.filters=g.filters.replace(Mc,function(){return g.type="html",""}),c.push(g)),v.appendChild(h);a.parentNode.replaceChild(v,a),c.length&&yc(c,b)}}function bd(a,b,c){var g,f,e=a.templateCache&&a.templateCache[b];if(e){for(f=d.createDocumentFragment();g=e.firstChild;)f.appendChild(g);return f}return avalon.parseHTML(c)}function dd(a){return null==a?"":a}function ed(a,b,c){return b.param.replace(/\w+/g,function(d){var e=avalon.duplexHooks[d];e&&"function"==typeof e[c]&&(a=e[c](a,b))}),a}function hd(){var a,b;for(a=gd.length-1;a>=0;a--)b=gd[a],b()===!1&&gd.splice(a,1);gd.length||clearInterval(fd)}function ld(a,b,c,e){var h,i,f=a.template.cloneNode(!0),g=avalon.slice(f.childNodes);f.insertBefore(d.createComment(a.signature),f.firstChild),b.appendChild(f),h=[c].concat(a.vmodels),i={nodes:g,vmodels:h},e.push(i)}function md(a){var e,d,b=[],c=a.element.parentNode.childNodes;for(d=0;e=c[d++];)if(e.nodeValue===a.signature)b.push(e);else if(e.nodeValue===a.signature+":end")break;return b}function nd(a,b,c){for(;;){var d=b.previousSibling;if(!d)break;if(d.parentNode.removeChild(d),c&&c.call(d),d===a)break}}function pd(){var a=_({$key:"",$outer:{},$host:{},$val:{get:function(){return this.$host[this.$key]},set:function(a){this.$host[this.$key]=a}}},{$val:1});return a.$id=A("$proxy$with"),a}function qd(a,b,c){a=a||od.pop(),a?a.$reinitialize():a=pd();var d=c.$repeat;return a.$key=b,a.$host=d,a.$outer=c.$outer,d.$events?a.$events.$val=d.$events[b]:a.$events={},a}function rd(a){sd(a)}function sd(a){a.forEach(function(a){wd(a,td)}),a.length=0}function ud(a){var c,d,b={$host:[],$outer:{},$index:0,$first:!1,$last:!1,$remove:avalon.noop};return b[a]={get:function(){var b=this.$events,c=b.$index;b.$index=b[a];try{return this.$host[this.$index]}finally{b.$index=c}},set:function(a){var b,c;try{b=this.$events,c=b.$index,b.$index=[],this.$host.set(this.$index,a)}finally{b.$index=c}}},c={$last:1,$first:1,$index:1},d=_(b,c),d.$id=A("$proxy$each"),d}function vd(a,b){var d,e,f,g,h,i,c=b.param||"el";for(e=0,f=td.length;f>e;e++)g=td[e],g&&g.hasOwnProperty(c)&&(d=g,td.splice(e,1));return d||(d=ud(c)),h=b.$repeat,i=h.length-1,d.$index=a,d.$first=0===a,d.$last=a===i,d.$host=h,d.$outer=b.$outer,d.$remove=function(){return h.removeAt(d.$index)},d}function wd(a,b){var c,d;for(c in a.$events)d=a.$events[c],Array.isArray(d)&&(d.forEach(function(a){"object"==typeof a&&Eb(a)}),d.length=0);a.$host=a.$outer={},b.unshift(a)>N.maxRepeatSize&&b.pop()}function xd(a,b){var e,c="_"+a;return xd[c]||(e=d.createElement(a),u.appendChild(e),b=t?getComputedStyle(e,null).display:e.currentStyle.display,u.removeChild(e),xd[c]=b),xd[c]}function Fd(a,b,c,d){a=(a+"").replace(/[^0-9+\-Ee.]/g,"");var e=isFinite(+a)?+a:0,f=isFinite(+b)?Math.abs(b):3,g=d||",",h=c||".",i="",j=function(a,b){var c=Math.pow(10,b);return""+(Math.round(a*c)/c).toFixed(b)};return i=(f?j(e,f):""+Math.round(e)).split("."),i[0].length>3&&(i[0]=i[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,g)),(i[1]||"").length<f&&(i[1]=i[1]||"",i[1]+=new Array(f-i[1].length+1).join("0")),i.join(h)}var f,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,A,C,D,F,G,I,J,K,M,O,P,Q,R,S,T,V,X,Y,Z,$,jb,lb,ob,pb,sb,tb,wb,xb,yb,Cb,Gb,Hb,Ib,Jb,Kb,Lb,Ob,Rb,Sb,Tb,Ub,Vb,Yb,Zb,$b,_b,ac,bc,cc,dc,ec,fc,ic,jc,kc,lc,mc,nc,oc,pc,uc,xc,zc,Ac,Bc,Cc,Dc,Ec,Hc,Ic,Mc,Nc,Qc,Rc,Vc,Wc,Xc,Yc,Zc,$c,_c,ad,cd,fd,gd,id,jd,kd,od,td,yd,zd,Ad,Bd,Cd,Dd,Ed,Gd,Hd,c=Date.now(),d=a.document,e=d.head;return e.insertAdjacentHTML("afterBegin",'<avalon ms-skip class="avalonHide"><style id="avalonStyle">.avalonHide{ display: none!important }</style></avalon>'),f=e.firstChild,i="$"+c,j=!1,k=/[^, ]+/g,l=/^(?:object|array)$/,m=/^\[object SVG\w*Element\]$/,n=/^\[object (?:Window|DOMWindow|global)\]$/,o=Object.prototype,p=o.hasOwnProperty,q=o.toString,r=Array.prototype,s=r.slice,t=a.dispatchEvent,u=d.documentElement,v=d.createDocumentFragment(),w=d.createElement("div"),x={},"Boolean Number String Function Array Date RegExp Object Error".replace(k,function(a){x["[object "+a+"]"]=a.toLowerCase()}),A=function(a){return a=a||"avalon",String(Math.random()+Math.random()).replace(/\d\.\d{4}/,a)},C=B(),avalon=function(a){return new avalon.init(a)},avalon.profile=function(){a.console&&avalon.config.profile&&Function.apply.call(console.log,console,arguments)},avalon.nextTick=new function(){function g(){var b,a=f.length;for(b=0;a>b;b++)f[b]();f=f.slice(a)}var f,h,b=a.setImmediate,c=a.MutationObserver;return b?b.bind(a):(f=[],c?(h=document.createTextNode("avalon"),new c(g).observe(h,{characterData:!0}),function(a){f.push(a),h.data=Math.random()}):a.VBArray?function(a){f.push(a);var b=d.createElement("script");b.onreadystatechange=function(){g(),b.onreadystatechange=null,e.removeChild(b),b=null},e.appendChild(b)}:function(a){setTimeout(a,4)})},avalon.init=function(a){this[0]=this.element=a},avalon.fn=avalon.prototype=avalon.init.prototype,avalon.type=function(a){return null==a?String(a):"object"==typeof a||"function"==typeof a?x[q.call(a)]||"object":typeof a},D=function(a){return"[object Function]"===q.call(a)},avalon.isFunction=D,avalon.isWindow=function(a){return n.test(q.call(a))},avalon.isPlainObject=function(a){return"[object Object]"===q.call(a)&&Object.getPrototypeOf(a)===o},avalon.mix=avalon.fn.mix=function(){var a,b,c,d,e,f,g=arguments[0]||{},h=1,i=arguments.length,j=!1;for("boolean"==typeof g&&(j=g,g=arguments[1]||{},h++),"object"==typeof g||D(g)||(g={}),h===i&&(g=this,h--);i>h;h++)if(null!=(a=arguments[h]))for(b in a)c=g[b],d=a[b],g!==d&&(j&&d&&(avalon.isPlainObject(d)||(e=Array.isArray(d)))?(e?(e=!1,f=c&&Array.isArray(c)?c:[]):f=c&&avalon.isPlainObject(c)?c:{},g[b]=avalon.mix(j,f,d)):void 0!==d&&(g[b]=d));return g},avalon.mix({rword:k,subscribers:i,version:1.472,ui:{},log:g,slice:function(a,b,c){return s.call(a,b,c)},noop:y,error:function(a,b){throw new(b||Error)(a)},oneObject:z,range:function(a,b,c){c||(c=1),null==b&&(b=a||0,a=0);for(var d=-1,e=Math.max(0,Math.ceil((b-a)/c)),f=new Array(e);++d<e;)f[d]=a,a+=c;return f},eventHooks:{},bind:function(a,b,c,d){var e=avalon.eventHooks,f=e[b];return"object"==typeof f&&(b=f.type||b,d=f.phase||!!d,c=f.fn?f.fn(a,c):c),a.addEventListener(b,c,d),c},unbind:function(a,b,c,d){var e=avalon.eventHooks,f=e[b],g=c||y;"object"==typeof f&&(b=f.type||b,d=f.phase||!!d),a.removeEventListener(b,g,d)},css:function(a,b,c){var e,d,f;if(a instanceof avalon&&(a=a[0]),d=/[_-]/.test(b)?Nb(b):b,b=avalon.cssName(d)||d,void 0===c||"boolean"==typeof c)return e=Rb[d+":get"]||Rb["@:get"],"background"===b&&(b="backgroundColor"),f=e(a,b),c===!0?parseFloat(f)||0:f;if(""===c)a.style[b]="";else{if(null==c||c!==c)return;isFinite(c)&&!avalon.cssNumber[d]&&(c+="px"),e=Rb[d+":set"]||Rb["@:set"],e(a,b,c)}},each:function(a,b){var c,d;if(a)if(c=0,H(a))for(d=a.length;d>c&&b(c,a[c])!==!1;c++);else for(c in a)if(a.hasOwnProperty(c)&&b(c,a[c])===!1)break},getWidgetData:function(a,b){var e,c=avalon(a).data(),d={};for(e in c)0===e.indexOf(b)&&(d[e.replace(b,"").replace(/\w/,function(a){return a.toLowerCase()})]=c[e]);return d},Array:{ensure:function(a,b){return-1===a.indexOf(b)?a.push(b):void 0},removeAt:function(a,b){return!!a.splice(b,1).length},remove:function(a,b){var c=a.indexOf(b);return~c?avalon.Array.removeAt(a,c):!1}}}),F=avalon.bindingHandlers={},G=avalon.bindingExecutors={},I=new function(){function a(a){this.size=0,this.limit=a,this.head=this.tail=void 0,this._keymap={}}var b=a.prototype;return b.put=function(a,b){var c={key:a,value:b};return this._keymap[a]=c,this.tail?(this.tail.newer=c,c.older=this.tail):this.head=c,this.tail=c,this.size===this.limit?this.shift():this.size++,b},b.shift=function(){var a=this.head;a&&(this.head=this.head.newer,this.head.older=a.newer=a.older=this._keymap[a.key]=void 0,delete this._keymap[a.key])},b.get=function(a){var b=this._keymap[a];if(void 0!==b)return b===this.tail?b.value:(b.newer&&(b===this.head&&(this.head=b.newer),b.newer.older=b.older),b.older&&(b.older.newer=b.newer),b.newer=void 0,b.older=this.tail,this.tail&&(this.tail.newer=b),this.tail=b,b.value)},a},d.contains||(Node.prototype.contains=function(a){return!!(16&this.compareDocumentPosition(a))}),avalon.contains=function(a,b){try{for(;b=b.parentNode;)if(b===a)return!0;return!1}catch(c){return!1}},a.SVGElement&&(J="http://www.w3.org/2000/svg",K=d.createElementNS(J,"svg"),K.innerHTML='<circle cx="50" cy="50" r="40" fill="red" />',m.test(K.firstChild)||Object.defineProperties(SVGElement.prototype,{outerHTML:{enumerable:!0,configurable:!0,get:function(){return(new XMLSerializer).serializeToString(this)},set:function(a){var f,b=this.tagName.toLowerCase(),c=this.parentNode,e=avalon.parseHTML(a);"svg"===b?c.insertBefore(e,this):(f=d.createDocumentFragment(),L(e,f),c.insertBefore(f,this)),c.removeChild(this)}},innerHTML:{enumerable:!0,configurable:!0,get:function(){var a=this.outerHTML,b=new RegExp("<"+this.nodeName+'\\b(?:(["\'])[^"]*?(\\1)|[^>])*>',"i"),c=new RegExp("</"+this.nodeName+">$","i");return a.replace(b,"").replace(c,"")},set:function(a){if(avalon.clearHTML){avalon.clearHTML(this);var b=avalon.parseHTML(a);L(b,this)}}}})),M=avalon.eventHooks,"onmouseenter"in u||avalon.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(a,b){M[a]={type:b,deel:function(b,c,d){return function(c){var e=c.relatedTarget;return e&&(e===b||16&b.compareDocumentPosition(e))?void 0:(delete c.type,c.type=a,d.call(b,c))}}}}),avalon.each({AnimationEvent:"animationend",WebKitAnimationEvent:"webkitAnimationEnd"},function(b,c){a[b]&&!M.animationend&&(M.animationend={type:c})}),void 0===d.onmousewheel&&(M.mousewheel={type:"wheel",fn:function(a,b){return function(c){c.wheelDeltaY=c.wheelDelta=c.deltaY>0?-120:120,c.wheelDeltaX=0,Object.defineProperty(c,"type",{value:"mousewheel"}),b.call(a,c)}}}),T=/[-.*+?^${}()|[\]\/\\]/g,V={interpolate:function(a){var b,c,d;if(O=a[0],P=a[1],O===P)throw new SyntaxError("openTag===closeTag");if(b=O+"test"+P,w.innerHTML=b,w.innerHTML!==b&&w.innerHTML.indexOf("&lt;")>-1)throw new SyntaxError("此定界符不合法");N.openTag=O,N.closeTag=P,w.innerHTML="",c=U(O),d=U(P),Q=new RegExp(c+"([\\s\\S]*)"+d),R=new RegExp(c+"([\\s\\S]*)"+d,"g"),S=new RegExp(c+"[\\s\\S]*"+d+"|\\sms-")}},N.debug=!0,N.plugins=V,N.plugins["interpolate"](["{{","}}"]),N.paths={},N.shim={},N.maxRepeatSize=100,avalon.config=N,X=function(a){return d.querySelectorAll(a)},Y={$watch:function(a,b){if("function"==typeof b){var c=this.$events[a];c?c.push(b):this.$events[a]=[b]}else this.$events=this.$watch.backup;return this},$unwatch:function(a,b){var d,e,c=arguments.length;if(0===c)this.$watch.backup=this.$events,this.$events={};else if(1===c)this.$events[a]=[];else for(d=this.$events[a]||[],e=d.length;~--e<0;)if(d[e]===b)return d.splice(e,1);return this},$fire:function(a){var b,c,e,f,g,h,i,j,k,l,m,n,o;if(/^(\w+)!(\S+)$/.test(a)&&(b=RegExp.$1,a=RegExp.$2),g=this.$events)if(h=s.call(arguments,1),i=[a].concat(h),"all"===b)for(c in avalon.vmodels)e=avalon.vmodels[c],e!==this&&e.$fire.apply(e,i);else if("up"===b||"down"===b){if(j=g.expr?X(g.expr):[],0===j.length)return;for(c in avalon.vmodels)if(e=avalon.vmodels[c],e!==this&&e.$events.expr){if(k=X(e.$events.expr),0===k.length)continue;r.forEach.call(k,function(a){r.forEach.call(j,function(c){var d="down"===b?c.contains(a):a.contains(c);d&&(a._avalon=e)})})}for(l=d.getElementsByTagName("*"),m=[],r.forEach.call(l,function(a){a._avalon&&(m.push(a._avalon),a._avalon="",a.removeAttribute("_avalon"))}),"up"===b&&m.reverse(),c=0;(f=m[c++])&&f.$fire.apply(f,i)!==!1;);}else{for(n=g[a]||[],o=g.$all||[],c=0;f=n[c++];)D(f)&&f.apply(this,h);for(c=0;f=o[c++];)D(f)&&f.apply(this,arguments)}}},Z=avalon.vmodels={},avalon.define=function(a,b){var d,e,c=a.$id||a;return c||g("warning: vm必须指定$id"),Z[c]&&g("warning: "+c+" 已经存在于avalon.vmodels中"),"object"==typeof a?d=_(a):(e={$watch:y},b(e),d=_(e),j=!0,b(d),j=!1),d.$id=c,Z[c]=d},$=String("$id,$watch,$unwatch,$fire,$events,$model,$skipArray,$reinitialize").match(k),jb=Object.is||function(a,b){return 0===a&&0===b?1/a===1/b:a!==a?b!==b:a===b},lb=function(a){var c,b={};for(c in a)b[c]={get:a[c],set:a[c],enumerable:!0,configurable:!0};return b},ob=r.splice,pb={_splice:ob,_fire:function(a,b,c){vb(this.$events[i],a,b,c)},size:function(){return this._.length},pushArray:function(a){var b=a.length,c=this.length;return b&&(r.push.apply(this.$model,a),nb.call(this,"add",c,b,Math.max(0,c-1))),b+c},push:function(){var b,a=[],c=arguments.length;for(b=0;c>b;b++)a[b]=arguments[b];return this.pushArray(a)},unshift:function(){var a=arguments.length,b=this.length;return a&&(r.unshift.apply(this.$model,arguments),nb.call(this,"add",0,a,0)),a+b},shift:function(){if(this.length){var a=this.$model.shift();return nb.call(this,"del",0,1,0),a}},pop:function(){var b,a=this.length;return a?(b=this.$model.pop(),nb.call(this,"del",a-1,1,Math.max(0,a-2)),b):void 0},splice:function(a){var d,b=arguments.length,c=[],e=ob.apply(this.$model,arguments);return e.length&&(c.push("del",a,e.length,0),d=!0),b>2&&(d?c.splice(3,1,0,"add",a,b-2):c.push("add",a,b-2,0),d=!0),d?nb.apply(this,c):[]},contains:function(a){return-1!==this.indexOf(a)},remove:function(a){return this.removeAt(this.indexOf(a))},removeAt:function(a){return a>=0?(this.$model.splice(a,1),nb.call(this,"del",a,1,0)):[]},clear:function(){return this.$model.length=this.length=this._.length=0,this._fire("clear",0),this},removeAll:function(a){var b,c;if(Array.isArray(a))for(b=this.length-1;b>=0;b--)-1!==a.indexOf(this[b])&&this.removeAt(b);else if("function"==typeof a)for(b=this.length-1;b>=0;b--)c=this[b],a(c,b)&&this.removeAt(b);else this.clear()},ensure:function(a){return this.contains(a)||this.push(a),this},set:function(a,b){var c,d,e;if(a<this.length&&a>-1)if(c=avalon.type(b),b&&b.$model&&(b=b.$model),d=this[a],"object"===c)for(e in b)d.hasOwnProperty(e)&&(d[e]=b[e]);else"array"===c?d.clear().push.apply(d,b):d!==b&&(this[a]=b,this.$model[a]=b,this._fire("set",a,b));return this}},"sort,reverse".replace(k,function(a){pb[a]=function(){var f,g,h,i,j,k,b=this.$model,c=b.concat(),d=Math.random(),e=[];for(r[a].apply(b,arguments),g=0,h=c.length;h>g;g++)i=b[g],j=c[g],jb(i,j)?e.push(g):(k=c.indexOf(i),e.push(k),c[k]=d,f=!0);return f&&(rb(this,e),this._fire("move",e),this._fire("index",0)),this}}),sb=function(){var b,a=[];return{begin:function(c){a.push(b),b=c},end:function(){b=a.pop()},collectDependency:function(a,c){b&&b.callback(a,c)}}}(),tb=/^(duplex|on)$/,avalon.injectBinding=function(a){var c,f,h,b=a.evaluator;if(b){sb.begin({callback:function(b,c){ub(b.$events[c._name],a)}});try{c=tb.test(a.type)?a:b.apply(0,a.args),void 0===c&&delete a.evaluator,a.handler&&a.handler(c,a.element,a)}catch(e){g("warning:exception throwed in [avalon.injectBinding] ",e),delete a.evaluator,f=a.element,f&&3===f.nodeType&&(h=f.parentNode,N.commentInterpolate?h.replaceChild(d.createComment(a.value),f):f.data=O+(a.oneTime?"::":"")+a.value+P)}finally{sb.end()}}},wb=0,xb=avalon.$$subscribers=[],yb=new Date,Cb=0,Gb=new function(){avalon.mix(this,{option:d.createElement("select"),thead:d.createElement("table"),td:d.createElement("tr"),area:d.createElement("map"),tr:d.createElement("tbody"),col:d.createElement("colgroup"),legend:d.createElement("fieldset"),_default:d.createElement("div"),g:d.createElementNS("http://www.w3.org/2000/svg","svg")}),this.optgroup=this.option,this.tbody=this.tfoot=this.colgroup=this.caption=this.thead,this.th=this.td},String("circle,defs,ellipse,image,line,path,polygon,polyline,rect,symbol,text,use").replace(k,function(a){Gb[a]=Gb.g}),Hb=/<([\w:]+)/,Ib=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,Jb=z(["","text/javascript","text/ecmascript","application/ecmascript","application/javascript"]),Kb=d.createElement("script"),Lb=/<|&#?\w+;/,avalon.parseHTML=function(a){var f,c,e,g,i,h,j,b=v.cloneNode(!1);if("string"!=typeof a)return b;if(!Lb.test(a))return b.appendChild(d.createTextNode(a)),b;if(a=a.replace(Ib,"<$1></$2>").trim(),c=(Hb.exec(a)||["",""])[1].toLowerCase(),e=Gb[c]||Gb._default,e.innerHTML=a,g=e.getElementsByTagName("script"),g.length)for(h=0;i=g[h++];)Jb[i.type]&&(j=Kb.cloneNode(!1),r.forEach.call(i.attributes,function(a){j.setAttribute(a.name,a.value)}),j.text=i.text,i.parentNode.replaceChild(j,i));for(;f=e.firstChild;)b.appendChild(f);return b},avalon.innerHTML=function(a,b){var c=this.parseHTML(b);this.clearHTML(a).appendChild(c)},avalon.clearHTML=function(a){for(a.textContent="";a.firstChild;)a.removeChild(a.firstChild);return a},"add,remove".replace(k,function(a){avalon.fn[a+"Class"]=function(b){var c=this[0];return b&&"string"==typeof b&&c&&1===c.nodeType&&b.replace(/\S+/g,function(b){c.classList[a](b)}),this}}),avalon.fn.mix({hasClass:function(a){var b=this[0]||{};return 1===b.nodeType&&b.classList.contains(a)},toggleClass:function(a,b){for(var c,g,d=0,e=String(a).split(/\s+/),f="boolean"==typeof b;c=e[d++];)g=f?b:!this.hasClass(c),this[g?"addClass":"removeClass"](c);return this},attr:function(a,b){return 2===arguments.length?(this[0].setAttribute(a,b),this):this[0].getAttribute(a)},data:function(a,b){var c,d;switch(a="data-"+Mb(a||""),arguments.length){case 2:return this.attr(a,b),this;case 1:return c=this.attr(a),Pb(c);case 0:return d={},r.forEach.call(this[0].attributes,function(b){b&&(a=b.name,a.indexOf("data-")||(a=Nb(a.slice(5)),d[a]=Pb(b.value)))}),d}},removeData:function(a){return a="data-"+Mb(a),this[0].removeAttribute(a),this},css:function(a,b){var c,d;if(avalon.isPlainObject(a))for(c in a)avalon.css(this,c,a[c]);else d=avalon.css(this,a,b);return void 0!==d?d:this},position:function(){var a,b,c=this[0],d={top:0,left:0};if(c)return"fixed"===this.css("position")?b=c.getBoundingClientRect():(a=this.offsetParent(),b=this.offset(),"HTML"!==a[0].tagName&&(d=a.offset()),d.top+=avalon.css(a[0],"borderTopWidth",!0),d.left+=avalon.css(a[0],"borderLeftWidth",!0),d.top-=a.scrollTop(),d.left-=a.scrollLeft()),{top:b.top-d.top-avalon.css(c,"marginTop",!0),left:b.left-d.left-avalon.css(c,"marginLeft",!0)}},offsetParent:function(){for(var a=this[0].offsetParent;a&&"static"===avalon.css(a,"position");)a=a.offsetParent;return avalon(a||u)},bind:function(a,b,c){return this[0]?avalon.bind(this[0],a,b,c):void 0},unbind:function(a,b,c){return this[0]&&avalon.unbind(this[0],a,b,c),this},val:function(a){var c,d,e,f,b=this[0];if(b&&1===b.nodeType)if(c=0===arguments.length,d=c?":get":":set",e=Yb[Xb(b)+d])f=e(b,a);else{if(c)return(b.value||"").replace(/\r/g,"");b.value=a}return c?f:this}}),u.dataset&&(avalon.fn.data=function(a,b){var c,d;switch(a=a&&Nb(a),c=this[0].dataset,arguments.length){case 2:return c[a]=b,this;case 1:return b=c[a],Pb(b);case 0:d=h();for(a in c)d[a]=Pb(c[a]);return d}}),Ob=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,avalon.parseJSON=JSON.parse,avalon.fireDom=function(a,b,c){var e=d.createEvent("Events");e.initEvent(b,!0,!0),avalon.mix(e,c),a.dispatchEvent(e)},avalon.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(a,b){avalon.fn[a]=function(c){var d=this[0]||{},e=Qb(d),f="scrollTop"===a;return arguments.length?(e?e.scrollTo(f?e[b]:c,f?c:e[b]):d[a]=c,void 0):e?e[b]:d[a]}}),Rb=avalon.cssHooks=h(),Sb=["","-webkit-","-moz-","-ms-"],Tb={"float":"cssFloat"},avalon.cssNumber=z("animationIterationCount,columnCount,order,flex,flexGrow,flexShrink,fillOpacity,fontWeight,lineHeight,opacity,orphans,widows,zIndex,zoom"),avalon.cssName=function(a,b,c){if(Tb[a])return Tb[a];b=b||u.style;for(var d=0,e=Sb.length;e>d;d++)if(c=Nb(Sb[d]+a),c in b)return Tb[a]=c;return null},Rb["@:set"]=function(a,b,c){a.style[b]=c},Rb["@:get"]=function(a,b){if(!a||!a.style)throw new Error("getComputedStyle要求传入一个节点 "+a);var c,d=getComputedStyle(a);
return d&&(c="filter"===b?d.getPropertyValue(b):d[b],""===c&&(c=a.style[b])),c},Rb["opacity:get"]=function(a){var b=Rb["@:get"](a,"opacity");return""===b?"1":b},"top,left".replace(k,function(a){Rb[a+":get"]=function(b){var c=Rb["@:get"](b,a);return/px$/.test(c)?c:avalon(b).position()[a]+"px"}}),Ub={position:"absolute",visibility:"hidden",display:"block"},Vb=/^(none|table(?!-c[ea]).+)/,"Width,Height".replace(k,function(a){var b=a.toLowerCase(),c="client"+a,d="scroll"+a,e="offset"+a;Rb[b+":get"]=function(b,c,d){var g,f=-4;return"number"==typeof d&&(f=d),c="Width"===a?["Left","Right"]:["Top","Bottom"],g=b[e],2===f?g+avalon.css(b,"margin"+c[0],!0)+avalon.css(b,"margin"+c[1],!0):(0>f&&(g=g-avalon.css(b,"border"+c[0]+"Width",!0)-avalon.css(b,"border"+c[1]+"Width",!0)),-4===f&&(g=g-avalon.css(b,"padding"+c[0],!0)-avalon.css(b,"padding"+c[1],!0)),g)},Rb[b+"&get"]=function(a){var d,f,e,g,c=[];for(Wb(a,c),d=Rb[b+":get"](a),e=0;f=c[e++];){a=f.node;for(g in f)"string"==typeof f[g]&&(a.style[g]=f[g])}return d},avalon.fn[b]=function(f){var h,g=this[0];return 0===arguments.length?g.setTimeout?g["inner"+a]:9===g.nodeType?(h=g.documentElement,Math.max(g.body[d],h[d],g.body[e],h[e],h[c])):Rb[b+"&get"](g):this.css(b,f)},avalon.fn["inner"+a]=function(){return Rb[b+":get"](this[0],void 0,-2)},avalon.fn["outer"+a]=function(a){return Rb[b+":get"](this[0],void 0,a===!0?2:0)}}),avalon.fn.offset=function(){var b,c,d,e,a=this[0];try{if(b=a.getBoundingClientRect(),b.width||b.height||a.getClientRects().length)return c=a.ownerDocument,d=c.documentElement,e=c.defaultView,{top:b.top+e.pageYOffset-d.clientTop,left:b.left+e.pageXOffset-d.clientLeft}}catch(f){return{left:0,top:0}}},Yb={"select:get":function(a,b){for(var c,d=a.options,e=a.selectedIndex,f="select-one"===a.type||0>e,g=f?null:[],h=f?e+1:d.length,i=0>e?h:f?e:0;h>i;i++)if(c=d[i],(c.selected||i===e)&&!c.disabled){if(b=c.value,f)return b;g.push(b)}return g},"select:set":function(a,b,c){b=[].concat(b);for(var e,d=0;e=a.options[d++];)(e.selected=b.indexOf(e.value)>-1)&&(c=!0);c||(a.selectedIndex=-1)}},Zb=JSON.stringify,$b=["break,case,catch,continue,debugger,default,delete,do,else,false","finally,for,function,if,in,instanceof,new,null,return,switch,this","throw,true,try,typeof,var,void,while,with","abstract,boolean,byte,char,class,const,double,enum,export,extends","final,float,goto,implements,import,int,interface,long,native","package,private,protected,public,short,static,super,synchronized","throws,transient,volatile","arguments,let,yield,undefined"].join(","),_b=/\/\*[\w\W]*?\*\/|\/\/[^\n]*\n|\/\/[^\n]*$|"(?:[^"\\]|\\[\w\W])*"|'(?:[^'\\]|\\[\w\W])*'|[\s\t\n]*\.[\s\t\n]*[$\w\.]+/g,ac=/[^\w$]+/g,bc=new RegExp(["\\b"+$b.replace(/,/g,"\\b|\\b")+"\\b"].join("|"),"g"),cc=/\b\d[^,]*/g,dc=/^,+|,+$/g,ec=new I(512),fc=function(a){var d,b=","+a.trim(),c=ec.get(b);return c?c:(d=a.replace(_b,"").replace(ac,",").replace(bc,"").replace(cc,"").replace(dc,"").split(/^$|,+/),ec.put(b,hc(d)))},ic=new I(128),jc=/\w\[.*\]|\w\.\w/,kc=/(\$proxy\$[a-z]+)\d+$/,lc=/\)\s*$/,mc=/\)\s*\|/g,nc=/\|\s*([$\w]+)/g,oc=/"\s*\["/g,pc=/"\s*\(/g,avalon.parseExprProxy=tc,avalon.scan=function(a,b){a=a||u;var c=b?[].concat(b):[];Lc(a,c)},uc=z("area,base,basefont,br,col,command,embed,hr,img,input,link,meta,param,source,track,wbr,noscript,script,style,textarea".toUpperCase()),xc=function(a,b,c){var f,e,d=a.getAttribute(b);if(d)for(e=0;f=c[e++];)if(f.hasOwnProperty(d)&&"function"==typeof f[d])return f[d]},zc=C&&a.MutationObserver?function(a){for(var c,d,b=a.firstChild;b;)d=b.nextSibling,3===b.nodeType?c?(c.nodeValue+=b.nodeValue,a.removeChild(b)):c=b:c=null,b=d}:0,Ac=/^\s*::/,Bc=/ms-(\w+)-?(.*)/,Cc={"if":10,repeat:90,data:100,widget:110,each:1400,"with":1500,duplex:2e3,on:3e3},Dc=z("animationend,blur,change,input,click,dblclick,focus,keydown,keypress,keyup,mousedown,mouseenter,mouseleave,mousemove,mouseout,mouseover,mouseup,scan,scroll,submit"),Ec=z("value,title,alt,checked,selected,disabled,readonly,enabled"),Hc=/^if|widget|repeat$/,Ic=/^each|with|html|include$/,Mc=/\|\s*html(?:\b|$)/,Nc=/\|\|/g,Qc=/(['"])(\\\1|.)+?\1/g,Rc=/\r?\n/g,Vc=["autofocus,autoplay,async,allowTransparency,checked,controls","declare,disabled,defer,defaultChecked,defaultSelected","contentEditable,isMap,loop,multiple,noHref,noResize,noShade","open,readOnly,selected"].join(","),Wc={},Vc.replace(k,function(a){Wc[a.toLowerCase()]=a}),Xc={"accept-charset":"acceptCharset","char":"ch",charoff:"chOff","class":"className","for":"htmlFor","http-equiv":"httpEquiv"},Yc=["accessKey,bgColor,cellPadding,cellSpacing,codeBase,codeType,colSpan","dateTime,defaultValue,frameBorder,longDesc,maxLength,marginWidth,marginHeight","rowSpan,tabIndex,useMap,vSpace,valueType,vAlign"].join(","),Yc.replace(k,function(a){Xc[a.toLowerCase()]=a}),Zc=/<noscript.*?>(?:[\s\S]+?)<\/noscript>/gim,$c=/<noscript.*?>([\s\S]+?)<\/noscript>/im,_c=function(){return new(a.XMLHttpRequest||ActiveXObject)("Microsoft.XMLHTTP")},ad=avalon.templateCache={},F.attr=function(a,b){var e,f,c=sc(a.value.trim());"include"===a.type&&(e=a.element,a.includeRendered=xc(e,"data-include-rendered",b),a.includeLoaded=xc(e,"data-include-loaded",b),f=a.includeReplace=!!avalon(e).data("includeReplace"),avalon(e).data("includeCache")&&(a.templateCache={}),a.startInclude=d.createComment("ms-include"),a.endInclude=d.createComment("ms-include-end"),f?(a.element=a.startInclude,e.parentNode.insertBefore(a.startInclude,e),e.parentNode.insertBefore(a.endInclude,e.nextSibling)):(e.insertBefore(a.startInclude,e.firstChild),e.appendChild(a.endInclude))),a.handlerName="attr",tc(c,b,a)},G.attr=function(b,c,e){var i,j,k,l,n,o,p,q,r,s,v,w,x,y,z,A,B,C,g=e.type,h=e.param;if("css"===g)avalon(c).css(h,b);else if("attr"===g){if(i=b===!1||null===b||void 0===b,!t&&Xc[h]&&(h=Xc[h]),j=Wc[h],"boolean"==typeof c[j]&&(c[j]=!!b,b||(i=!0)),i)return c.removeAttribute(h);k=m.test(c)?!1:d.namespaces&&isVML(c)?!0:h in c.cloneNode(!1),k?c[h]=b+"":c.setAttribute(h,b)}else if("include"===g&&b){if(l=e.vmodels,n=e.includeRendered,o=e.includeLoaded,p=e.includeReplace,q=p?c.parentNode:c,r=function(a){var c,g,h,i,j,k;if(null!==e.vmodels){for(o&&(c=o.apply(q,[a].concat(l)),"string"==typeof c&&(a=c)),n&&vc(q,function(){n.call(q)},0/0),g=e.includeLastID,e.templateCache&&g&&g!==b&&(h=e.templateCache[g],h||(h=e.templateCache[g]=d.createElement("div"),f.appendChild(h))),e.includeLastID=b;e.startInclude&&(i=e.startInclude.nextSibling,i&&i!==e.endInclude);)q.removeChild(i),h&&h.appendChild(i);j=bd(e,b,a),k=avalon.slice(j.childNodes),q.insertBefore(j,e.endInclude),Kc(k,l)}},"src"===e.param)"string"==typeof ad[b]?avalon.nextTick(function(){r(ad[b])}):Array.isArray(ad[b])?ad[b].push(r):(s=_c(),s.onreadystatechange=function(){var a,c,e,d;if(4===s.readyState&&(a=s.status,a>=200&&300>a||304===a||1223===a)){for(c=s.responseText,d=0;e=ad[b][d++];)e(c);ad[b]=c}},ad[b]=[r],s.open("GET",b,!0),"withCredentials"in s&&(s.withCredentials=!0),s.setRequestHeader("X-Requested-With","XMLHttpRequest"),s.send(null));else if(v=b&&1===b.nodeType?b:d.getElementById(b)){if("NOSCRIPT"===v.tagName&&!v.innerHTML&&!v.fixIE78)for(s=_c(),s.open("GET",location,!1),s.send(null),w=d.getElementsByTagName("noscript"),x=(s.responseText||"").match(Zc)||[],y=x.length,z=0;y>z;z++)A=w[z],A&&(A.style.display="none",A.fixIE78=(x[z].match($c)||["","&nbsp;"])[1]);avalon.nextTick(function(){r(v.fixIE78||v.value||v.innerText||v.innerHTML)})}}else u.hasAttribute||"string"!=typeof b||"src"!==g&&"href"!==g||(b=b.replace(/&amp;/g,"&")),c[g]=b,a.chrome&&"EMBED"===c.tagName&&(B=c.parentNode,C=document.createComment("ms-src"),B.replaceChild(C,c),B.replaceChild(c,C))},"title,alt,src,value,css,include,href".replace(k,function(a){F[a]=F.attr}),F["class"]=function(a,b){var e,f,g,h,i,j,k,l,m,n,o,c=a.param,d=a.value;a.handlerName="class",!c||isFinite(c)?(a.param="",f=d.replace(R,function(a){return a.replace(/./g,"0")}).indexOf(":"),-1===f?(g=d,e=!0):(g=d.slice(0,f),e=d.slice(f+1)),g=Q.test(d)?sc(g):Zb(g),a.expr="["+g+","+e+"]"):(a.expr="["+Zb(c)+","+d+"]",a.oldStyle=c),h=a.type,("hover"===h||"active"===h)&&(a.hasBindEvent||(i=a.element,j=avalon(i),k="mouseenter",l="mouseleave","active"===h&&(i.tabIndex=i.tabIndex||-1,k="mousedown",l="mouseup",m=j.bind("mouseleave",function(){a.toggleClass&&j.removeClass(a.newClass)}))),n=j.bind(k,function(){a.toggleClass&&j.addClass(a.newClass)}),o=j.bind(l,function(){a.toggleClass&&j.removeClass(a.newClass)}),a.rollback=function(){j.unbind("mouseleave",m),j.unbind(k,n),j.unbind(l,o)},a.hasBindEvent=!0),tc(a.expr,b,a)},G["class"]=function(a,b,c){var d=avalon(b);c.newClass=a[0],c.toggleClass=!!a[1],c.oldClass&&c.newClass!==c.oldClass&&d.removeClass(c.oldClass),c.oldClass=c.newClass,"class"===c.type&&(c.oldStyle?d.toggleClass(c.oldStyle,!!a[1]):d.toggleClass(c.newClass,c.toggleClass))},"hover,active".replace(k,function(a){F[a]=F["class"]}),G.data=function(a,b,c){var d="data-"+c.param;a&&"object"==typeof a?b[d]=a:b.setAttribute(d,String(a))},cd=F.duplex=function(a,b){var d,e,f,h,i,j,k,c=a.element;if(tc(a.value,b,a,1),a.changed=xc(c,"data-duplex-changed",b)||y,a.evaluator&&a.args){e=[],f=z("string,number,boolean,checked"),"radio"===c.type&&""===a.param&&(a.param="checked"),c.msData&&(c.msData["ms-duplex"]=a.value),a.param.replace(/\w+/g,function(b){/^(checkbox|radio)$/.test(c.type)&&/^(radio|checked)$/.test(b)&&("radio"===b&&g("ms-duplex-radio已经更名为ms-duplex-checked"),b="checked",a.isChecked=!0),"bool"===b?(b="boolean",g("ms-duplex-bool已经更名为ms-duplex-boolean")):"text"===b&&(b="string",g("ms-duplex-text已经更名为ms-duplex-string")),f[b]&&(d=!0),avalon.Array.ensure(e,b)}),d||e.push("string"),a.param=e.join("-"),a.bound=function(b,d){c.addEventListener?c.addEventListener(b,d,!1):c.attachEvent("on"+b,d);var e=a.rollback;a.rollback=function(){c.avalonSetter=null,avalon.unbind(c,b,d),e&&e()}};for(h in avalon.vmodels)i=avalon.vmodels[h],i.$fire("avalon-ms-duplex-init",a);j=a.pipe||(a.pipe=ed),j(null,a,"init"),k=c.tagName,cd[k]&&cd[k](c,a.evaluator.apply(null,a.args),a)}},avalon.duplexHooks={checked:{get:function(a,b){return!b.element.oldValue}},string:{get:function(a){return a},set:dd},"boolean":{get:function(a){return"true"===a},set:dd},number:{get:function(a,b){var d,c=parseFloat(a);if(-a===-c)return c;switch(d=/strong|medium|weak/.exec(b.element.getAttribute("data-duplex-number"))||["medium"],d[0]){case"strong":return 0;case"medium":return""===a?"":0;case"weak":return a}},set:dd}},gd=[],avalon.tick=function(a){1===gd.push(a)&&(fd=setInterval(hd,60))},id=y,new function(){function d(b){a[this.tagName].call(this,b),!this.msFocus&&this.avalonSetter&&this.avalonSetter()}var a,b,c,e;try{a={},b=HTMLInputElement.prototype,c=HTMLTextAreaElement.prototype,e=HTMLInputElement.prototype,Object.getOwnPropertyNames(e),a["INPUT"]=Object.getOwnPropertyDescriptor(b,"value").set,Object.defineProperty(b,"value",{set:d}),a["TEXTAREA"]=Object.getOwnPropertyDescriptor(c,"value").set,Object.defineProperty(c,"value",{set:d})}catch(f){id=avalon.tick}},jd=/^(file|button|reset|submit|checkbox|radio|range)$/,cd.INPUT=function(a,b,c){function i(a){c.changed.call(this,a,c)}function j(){h=!0}function l(){h=!1}var m,o,d=a.type,e=c.bound,f=avalon(a),h=!1,n=function(){var e,d=a.value;h||d===m||(e=c.pipe(d,c,"get"),f.data("duplexObserve")!==!1&&(m=d,b(e),i.call(a,e)))};c.handler=function(){var e,f,g,h,d=c.pipe(b(),c,"set");if(d!==m){if(e=!1,a.msFocus)try{f=a.selectionStart,g=a.selectionEnd,f===g&&(h=f,e=!0)}catch(i){}a.value=m=d,e&&!a.readyOnly&&(a.selectionStart=a.selectionEnd=h)}},c.isChecked||"radio"===d?(n=function(){if(f.data("duplexObserve")!==!1){var d=c.pipe(a.value,c,"get");b(d),i.call(a,d)}},c.handler=function(){var d=b(),e=c.isChecked?!!d:d+""===a.value;a.checked=a.oldValue=e},e("click",n)):"checkbox"===d?(n=function(){var d,e;f.data("duplexObserve")!==!1&&(d=a.checked?"ensure":"remove",e=b(),Array.isArray(e)||(g("ms-duplex应用于checkbox上要对应一个数组"),e=[e]),avalon.Array[d](e,c.pipe(a.value,c,"get")),i.call(a,e))},c.handler=function(){var d=[].concat(b());a.checked=d.indexOf(c.pipe(a.value,c,"get"))>-1},e("change",n)):(o=a.getAttribute("data-duplex-event")||"input",a.attributes["data-event"]&&g("data-event指令已经废弃，请改用data-duplex-event"),o.replace(k,function(a){switch(a){case"input":e("input",n),e("keyup",n),C||(e("compositionstart",j),e("compositionend",l),e("DOMAutoComplete",n));break;default:e(a,n)}}),jd.test(d)||("hidden"!==d&&(e("focus",function(){a.msFocus=!0}),e("blur",function(){a.msFocus=!1})),a.avalonSetter=n,id(function(){if(u.contains(a))a.msFocus||n();else if(!a.msRetain)return!1}))),avalon.injectBinding(c),i.call(a,a.value)},cd.TEXTAREA=cd.INPUT,cd.SELECT=function(a,b,c){function e(){if(d.data("duplexObserve")!==!1){var e=d.val();e=Array.isArray(e)?e.map(function(a){return c.pipe(a,c,"get")}):c.pipe(e,c,"get"),e+""!==a.oldValue&&b(e),c.changed.call(a,e,c)}}var d=avalon(a);c.handler=function(){var c=b();c=c&&c.$model||c,Array.isArray(c)?a.multiple||g("ms-duplex在<select multiple=true>上要求对应一个数组"):a.multiple&&g("ms-duplex在<select multiple=false>不能对应一个数组"),c=Array.isArray(c)?c.map(String):c+"",c+""!==a.oldValue&&(d.val(c),a.oldValue=c+"")},c.bound("change",e),a.msCallback=function(){avalon.injectBinding(c),c.changed.call(a,b(),c)}},G.html=function(a,b,c){var g,h,i,j,k,e=1!==b.nodeType,f=e?b.parentNode:b;if(f&&(a=null==a?"":a,c.oldText!==a)){if(c.oldText=a,3===b.nodeType&&(g=A("html"),f.insertBefore(d.createComment(g),b),c.element=d.createComment(g+":end"),f.replaceChild(c.element,b),b=c.element),"object"!=typeof a)h=avalon.parseHTML(String(a));else if(11===a.nodeType)h=a;else if(1===a.nodeType||a.item)for(i=1===a.nodeType?a.childNodes:a.item,h=v.cloneNode(!0);i[0];)h.appendChild(i[0]);if(i=avalon.slice(h.childNodes),e){for(j=b.nodeValue.slice(0,-4);;){if(k=b.previousSibling,!k||8===k.nodeType&&k.nodeValue===j)break;f.removeChild(k)}f.insertBefore(h,b)}else avalon.clearHTML(b).appendChild(h);Kc(i,c.vmodels)}},F["if"]=F.data=F.text=F.html=function(a,b){tc(a.value,b,a)},G["if"]=function(a,b,c){try{if(!b.parentNode)return}catch(e){return}if(a)8===b.nodeType&&(b.parentNode.replaceChild(c.template,b),b.ifRemove=null,b=c.element=c.template),b.getAttribute(c.name)&&(b.removeAttribute(c.name),Gc(b,c.vmodels)),c.rollback=null;else if(1===b.nodeType){var g=c.element=d.createComment("ms-if");b.parentNode.replaceChild(g,b),b.ifRemove=g,c.template=b,f.appendChild(b),c.rollback=function(){b.parentNode===f&&f.removeChild(b)}}},kd=/\(([^)]*)\)/,F.on=function(a,b){var d,e,c=a.value;a.type="on",d=a.param.replace(/-\d+$/,""),"function"==typeof F.on[d+"Hook"]&&F.on[d+"Hook"](a),c.indexOf("(")>0&&c.indexOf(")")>-1&&(e=(c.match(kd)||["",""])[1].trim(),(""===e||"$event"===e)&&(c=c.replace(kd,""))),tc(c,b,a)},G.on=function(a,b,c){var d,e;a=function(a){var b=c.evaluator||y;return b.apply(this,c.args.concat(a))},d=c.param.replace(/-\d+$/,""),"scan"===d?a.call(b,{type:d}):"function"==typeof c.specialBind?c.specialBind(b,a):e=avalon.bind(b,d,a),c.rollback=function(){"function"==typeof c.specialUnbind?c.specialUnbind():avalon.unbind(b,d,e)}},F.repeat=function(a,b){var e,f,g,j,k,m,l,n,o,p,q,r,s,t,u,w,x,z,c=a.type;tc(a.value,b,a,1),a.proxies=[],e=!1;try{f=a.$repeat=a.evaluator.apply(0,a.args||[]),g=avalon.type(f),"object"!==g&&"array"!==g?(e=!0,avalon.log("warning:"+a.value+"只能是对象或数组")):a.xtype=g}catch(h){e=!0}if(j=a.value.split(".")||[],j.length>1)for(j.pop(),k=j[0],l=0;m=b[l++];)if(m&&m.hasOwnProperty(k)){n=m[k].$events||{},n[i]=n[i]||[],ub(n[i],a);break}if(o=a.handler,a.handler=y,avalon.injectBinding(a),a.handler=o,p=a.element,1===p.nodeType){if(p.removeAttribute(a.name),a.sortedCallback=xc(p,"data-with-sorted",b),a.renderedCallback=xc(p,"data-"+c+"-rendered",b),q=A(c),r=d.createComment(q),s=d.createComment(q+":end"),a.signature=q,a.template=v.cloneNode(!1),"repeat"===c)t=p.parentNode,t.replaceChild(s,p),t.insertBefore(r,s),a.template.appendChild(p);else{for(;p.firstChild;)a.template.appendChild(p.firstChild);p.appendChild(r),p.appendChild(s)}a.element=s,a.handler=G.repeat,a.rollback=function(){var b=a.element;b&&a.handler("clear")}}if(!e){for(a.$outer={},u="$key",w="$val",Array.isArray(f)&&(u="$first",w="$last"),l=0;m=b[l++];)if(m.hasOwnProperty(u)&&m.hasOwnProperty(w)){a.$outer=m;break}x=f.$events,z=(x||{})[i],ub(z,a),"object"===g?a.handler("append"):f.length&&a.handler("add",0,f.length)}},G.repeat=function(a,b,c){var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,w,u,x,z,A,B,C,D,E,F,d=this;if(!a&&d.xtype)if(e=d.$repeat,f=d.evaluator.apply(0,d.args||[]),"array"===d.xtype){if(e.length===f.length){if(!(e!==f&&e.length>0))return;G.repeat.call(this,"clear",b,c)}a="add",b=0,d.$repeat=f,c=f.length}else{if(bb(e).join(";;")===bb(f).join(";;"))return;a="append",d.$repeat=f}if(a){switch(i=d.element,j=md(d),k=i.parentNode,l=d.proxies,m=v.cloneNode(!1),a){case"add":for(n=b+c,o=[],p=b;n>p;p++)q=vd(p,d),l.splice(p,0,q),ld(d,m,q,o);for(k.insertBefore(m,j[b]||i),p=0;h=o[p++];)Kc(h.nodes,h.vmodels),h.nodes=h.vmodels=null;break;case"del":nd(j[b],j[b+c]||i),r=l.splice(b,c),rd(r,"each");break;case"clear":g=j[0],g&&(nd(g,i),"object"===d.xtype?k.insertBefore(g,i):rd(l,"each"));break;case"move":if(g=j[0]){for(s=g.nodeValue,t=[],u=[],nd(g,i,function(){u.unshift(this),this.nodeValue===s&&(t.unshift(u),u=[])}),rb(t,b),rb(l,b);u=t.shift();)for(;w=u.shift();)m.appendChild(w);k.insertBefore(m,i)}break;case"index":for(x=l.length-1;c=l[b];b++)c.$index=b,c.$first=0===b,c.$last=b===x;return;case"set":q=l[b],q&&vb(q.$events[d.param||"el"]);break;case"append":z=d.$repeat,A=Array.isArray(l)||!l?{}:l,d.proxies=A,B=[],o=[];for(C in A)z.hasOwnProperty(C)||(wd(A[C],od),delete A[C]);for(C in z)z.hasOwnProperty(C)&&"hasOwnProperty"!==C&&B.push(C);for(d.sortedCallback&&(D=d.sortedCallback.call(k,B),D&&Array.isArray(D)&&D.length&&(B=D)),p=0;C=B[p++];)"hasOwnProperty"!==C&&(A[C]=qd(A[C],C,d),ld(d,m,A[C],o));for(k.insertBefore(m,i),p=0;h=o[p++];)Kc(h.nodes,h.vmodels),h.nodes=h.vmodels=null}if(!d.$repeat||d.$repeat.hasOwnProperty("$lock"))return;"clear"===a&&(a="del"),E=d.renderedCallback||y,F=arguments,k.oldValue&&"SELECT"===k.tagName&&avalon(k).val(k.oldValue.split(",")),E.apply(k,F)}},"with,each".replace(k,function(a){F[a]=F.repeat}),od=[],td=[],G.text=function(a,b){if(a=null==a?"":a,3===b.nodeType)try{b.data=a}catch(c){}else b.textContent=a},avalon.parseDisplay=xd,F.visible=function(a,b){tc(a.value,b,a)},G.visible=function(a,b,c){a?(b.style.display=c.display||"","none"===avalon(b).css("display")&&(b.style.display=c.display=xd(b.nodeName))):b.style.display="none"},F.widget=function(b,c){var i,j,m,l,n,o,p,q,r,d=b.value.match(k),e=b.element,f=d[0],h=d[1];if(h&&"$"!==h||(h=A(f)),i=d[2]||f,j=avalon.ui[f],"function"==typeof j){for(c=e.vmodels||c,l=0;m=c[l++];)if(m.hasOwnProperty(i)&&"object"==typeof m[i]){n=m[i],n=n.$model||n;break}if(n&&(o=n[f+"Id"],"string"==typeof o&&(g("warning!不再支持"+f+"Id"),h=o)),p=avalon.getWidgetData(e,f),b.value=[f,h,i].join(","),b[f+"Id"]=h,b.evaluator=y,e.msData["ms-widget-id"]=h,q=b[f+"Options"]=avalon.mix({},j.defaults,n||{},p),e.removeAttribute("ms-widget"),r=j(e,b,c)||{},r.$id){avalon.vmodels[h]=r,wc(e,r);try{r.$init(function(){avalon.scan(e,[r].concat(c)),"function"==typeof q.onInit&&q.onInit.call(e,r,q,c)})}catch(s){g(s)}b.rollback=function(){try{r.$remove(),r.widgetElement=null}catch(a){}e.msData={},delete avalon.vmodels[r.$id]},Bb(b,yd),a.chrome&&e.addEventListener("DOMNodeRemovedFromDocument",function(){setTimeout(Db)})}else avalon.scan(e,c)}else c.length&&(e.vmodels=c)},yd=[],zd=/<script[^>]*>([\S\s]*?)<\/script\s*>/gim,Ad=/\s+(on[^=\s]+)(?:=("[^"]*"|'[^']*'|[^\s>]+))?/g,Bd=/<\w+\b(?:(["'])[^"]*?(\1)|[^>])*>/gi,Cd={a:/\b(href)\=("javascript[^"]*"|'javascript[^']*')/gi,img:/\b(src)\=("javascript[^"]*"|'javascript[^']*')/gi,form:/\b(action)\=("javascript[^"]*"|'javascript[^']*')/gi},Dd=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,Ed=/([^\#-~| |!])/g,Gd=avalon.filters={uppercase:function(a){return a.toUpperCase()},lowercase:function(a){return a.toLowerCase()},truncate:function(a,b,c){return b=b||30,c="string"==typeof c?c:"...",a.length>b?a.slice(0,b-c.length)+c:String(a)},$filter:function(a){var b,c,d,e,f;for(b=1,c=arguments.length;c>b;b++)d=arguments[b],e=avalon.filters[d[0]],"function"==typeof e&&(f=[a].concat(d.slice(1)),a=e.apply(null,f));return a},camelize:Nb,sanitize:function(a){return a.replace(zd,"").replace(Bd,function(a){var d,c=a.toLowerCase().match(/<(\w+)\s/);return c&&(d=Cd[c[1]],d&&(a=a.replace(d,function(a,b,c){var d=c.charAt(0);return b+"="+d+"javascript:void(0)"+d}))),a.replace(Ad," ").replace(/\s+/g," ")})},escape:function(a){return String(a).replace(/&/g,"&amp;").replace(Dd,function(a){var b=a.charCodeAt(0),c=a.charCodeAt(1);return"&#"+(1024*(b-55296)+(c-56320)+65536)+";"}).replace(Ed,function(a){return"&#"+a.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")},currency:function(a,b,c){return(b||"￥")+Fd(a,isFinite(c)?c:2)},number:Fd},new function(){function a(a){return parseInt(a,10)||0}function b(a,b,c){var d="";for(0>a&&(d="-",a=-a),a=""+a;a.length<b;)a="0"+a;return c&&(a=a.substr(a.length-b)),d+a}function c(a,c,d,e){return function(f){var g=f["get"+a]();return(d>0||g>-d)&&(g+=d),0===g&&-12===d&&(g=12),b(g,c,e)}}function d(a,b){return function(c,d){var e=c["get"+a](),f=(b?"SHORT"+a:a).toUpperCase();return d[f][e]}}function e(a){var c=-1*a.getTimezoneOffset(),d=c>=0?"+":"";return d+=b(Math[c>0?"floor":"ceil"](c/60),2)+b(Math.abs(c%60),2)}function f(a,b){return a.getHours()<12?b.AMPMS[0]:b.AMPMS[1]}var j,g={yyyy:c("FullYear",4),yy:c("FullYear",2,0,!0),y:c("FullYear",1),MMMM:d("Month"),MMM:d("Month",!0),MM:c("Month",2,1),M:c("Month",1,1),dd:c("Date",2),d:c("Date",1),HH:c("Hours",2),H:c("Hours",1),hh:c("Hours",2,-12),h:c("Hours",1,-12),mm:c("Minutes",2),m:c("Minutes",1),ss:c("Seconds",2),s:c("Seconds",1),sss:c("Milliseconds",3),EEEE:d("Day"),EEE:d("Day",!0),a:f,Z:e},h=/((?:[^yMdHhmsaZE']+)|(?:'(?:[^']|'')*')|(?:E+|y+|M+|d+|H+|h+|m+|s+|a|Z))(.*)/,i=/^\/Date\((\d+)\)\/$/;Gd.date=function(b,c){var j,k,l,m,n,o,p,q,r,d=Gd.date.locate,e="",f=[];if(c=c||"mediumDate",c=d[c]||c,"string"==typeof b&&(/^\d+$/.test(b)?b=a(b):i.test(b)?b=+RegExp.$1:(l=b.trim(),m=[0,0,0,0,0,0,0],n=new Date(0),l=l.replace(/^(\d+)\D(\d+)\D(\d+)/,function(b,c,d,e){var f=4===e.length?[e,c,d]:[c,d,e];return m[0]=a(f[0]),m[1]=a(f[1])-1,m[2]=a(f[2]),""}),o=n.setFullYear,p=n.setHours,l=l.replace(/[T\s](\d+):(\d+):?(\d+)?\.?(\d)?/,function(b,c,d,e,f){return m[3]=a(c),m[4]=a(d),m[5]=a(e),f&&(m[6]=Math.round(1e3*parseFloat("0."+f))),""}),q=0,r=0,l=l.replace(/Z|([+-])(\d\d):?(\d\d)/,function(b,c,d,e){return o=n.setUTCFullYear,p=n.setUTCHours,c&&(q=a(c+d),r=a(c+e)),""}),m[3]-=q,m[4]-=r,o.apply(n,m.slice(0,3)),p.apply(n,m.slice(3)),b=n)),"number"==typeof b&&(b=new Date(b)),"date"===avalon.type(b)){for(;c;)k=h.exec(c),k?(f=f.concat(k.slice(1)),c=f.pop()):(f.push(c),c=null);return f.forEach(function(a){j=g[a],e+=j?j(b,d):a.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),e}},j={AMPMS:{0:"上午",1:"下午"},DAY:{0:"星期日",1:"星期一",2:"星期二",3:"星期三",4:"星期四",5:"星期五",6:"星期六"},MONTH:{0:"1月",1:"2月",2:"3月",3:"4月",4:"5月",5:"6月",6:"7月",7:"8月",8:"9月",9:"10月",10:"11月",11:"12月"},SHORTDAY:{0:"周日",1:"周一",2:"周二",3:"周三",4:"周四",5:"周五",6:"周六"},fullDate:"y年M月d日EEEE",longDate:"y年M月d日",medium:"yyyy-M-d H:mm:ss",mediumDate:"yyyy-M-d",mediumTime:"H:mm:ss","short":"yy-M-d ah:mm",shortDate:"yy-M-d",shortTime:"ah:mm"},j.SHORTMONTH=j.MONTH,Gd.date.locate=j},new function(){function e(c){for(b=1;c=a.shift();)c()}var c,a,b,f;avalon.config({loader:!1}),a=[],b="complete"===d.readyState,avalon.bind(d,"DOMContentLoaded",c=function(){avalon.unbind(d,"DOMContentLoaded",c),e()}),f=setInterval(function(){"complete"===document.readyState&&document.body&&(clearInterval(f),e())},50),avalon.ready=function(c){b?c(avalon):a.push(c)},avalon.ready(function(){avalon.scan(d.body)})},new function(){function c(){return/iPad|iPhone|iPod/i.test(b)&&!a.MSStream?"backdropFilter"in document.documentElement.style?9:a.indexedDB?8:a.SpeechSynthesisUtterance?7:a.webkitAudioContext?6:a.matchMedia?5:a.history&&"pushState"in a.history?4:3:0/0}function h(a,b){return b&&g.forEach(function(c){a[c]=b[c]}),a}var j,k,l,b=navigator.userAgent.toLowerCase(),d=b.indexOf("android")>0,e=c(),f=avalon.gestureHooks={pointers:{},start:function(a,b){var c,d,e;for(c=0;c<a.changedTouches.length;c++)d=a.changedTouches[c],e={startTouch:h({},d),startTime:Date.now(),status:"tapping",element:a.target},f.pointers[d.identifier]=e,b(e,d)},move:function(a,b){var c,d,e,g,i,j,k;for(c=0;c<a.changedTouches.length;c++){if(d=a.changedTouches[c],e=f.pointers[d.identifier],!e)return;"lastTouch"in e||(e.lastTouch=e.startTouch,e.lastTime=e.startTime,e.deltaX=e.deltaY=e.duration=e.distance=0),g=Date.now()-e.lastTime,g>0&&(i=70,g>i&&(g=i),e.duration+g>i&&(e.duration=i-g),e.duration+=g,e.lastTouch=h({},d),e.lastTime=Date.now(),e.deltaX=d.clientX-e.startTouch.clientX,e.deltaY=d.clientY-e.startTouch.clientY,j=e.deltaX*e.deltaX,k=e.deltaY*e.deltaY,e.distance=Math.sqrt(j+k),e.isVertical=k>j,b(e,d))}},end:function(a,b){var c,d,e,g;for(c=0;c<a.changedTouches.length;c++)d=a.changedTouches[c],e=d.identifier,g=f.pointers[e],g&&(b(g,d),delete f.pointers[e])},fire:function(a,b,c){if(a){var d=document.createEvent("Events");d.initEvent(b,!0,!0),avalon.mix(d,c),a.dispatchEvent(d)}},add:function(a,b){function c(a){b.touchmove(a)}function d(a){b.touchend(a),document.removeEventListener("touchmove",c),document.removeEventListener("touchend",d),document.removeEventListener("touchcancel",e)}function e(a){b.touchcancel(a),document.removeEventListener("touchmove",c),document.removeEventListener("touchend",d),document.removeEventListener("touchcancel",e)}b.events.forEach(function(f){avalon.eventHooks[f]={fn:function(f,g){return f["touch-"+a]||(f["touch-"+a]="1",f.addEventListener("touchstart",function(a){b.touchstart(a),document.addEventListener("touchmove",c),document.addEventListener("touchend",d),document.addEventListener("touchcancel",e)})),g}}})}},g=["screenX","screenY","clientX","clientY","pageX","pageY"],i=!!navigator.pointerEnabled||!!navigator.msPointerEnabled;i&&(u.style.msTouchAction=u.style.touchAction="none"),j={events:["tap"],touchBoundary:10,tapDelay:200,needClick:function(a){switch(a.nodeName.toLowerCase()){case"button":case"select":case"textarea":if(a.disabled)return!0;break;case"input":if(e&&"file"===a.type||a.disabled)return!0;break;case"label":case"iframe":case"video":return!0}return!1},needFocus:function(a){switch(a.nodeName.toLowerCase()){case"textarea":case"select":return!0;case"input":switch(a.type){case"button":case"checkbox":case"file":case"image":case"radio":case"submit":return!1}return!a.disabled&&!a.readOnly;default:return!1}},focus:function(a){var b,c=a.type;e&&a.setSelectionRange&&0!==c.indexOf("date")&&"time"!==c&&"month"!==c?(b=a.value.length,a.setSelectionRange(b,b)):a.focus()},findControl:function(a){return void 0!==a.control?a.control:a.htmlFor?document.getElementById(a.htmlFor):a.querySelector("button, input:not([type=hidden]), keygen, meter, output, progress, select, textarea")},fixTarget:function(b){return 3===b.nodeType?b.parentNode:a.SVGElementInstance&&b instanceof SVGElementInstance?b.correspondingUseElement:b},updateScrollParent:function(a){var c,b=a.tapScrollParent;if(!b||!b.contains(a)){c=a;do{if(c.scrollHeight>c.offsetHeight){b=c,a.tapScrollParent=c;break}c=c.parentElement}while(c)}b&&(b.lastScrollTop=b.scrollTop)},touchHasMoved:function(a){var b=a.changedTouches[0],c=j.touchBoundary;return Math.abs(b.pageX-j.pageX)>c||Math.abs(b.pageY-j.pageY)>c},findType:function(a){return d&&"select"===a.tagName.toLowerCase()?"mousedown":"click"},sendClick:function(b,c){f.fire(b,"tap",{touchEvent:c});var d,e;document.activeElement&&document.activeElement!==b&&document.activeElement.blur(),e=c.changedTouches[0],d=document.createEvent("MouseEvents"),d.initMouseEvent(j.findType(b),!0,!0,a,1,e.screenX,e.screenY,e.clientX,e.clientY,!1,!1,!1,!1,0,null),d.touchEvent=c,b.dispatchEvent(d)},touchstart:function(b){var c,d,f,g;if(1!==b.targetTouches.length)return!0;if(c=j.fixTarget(b.target),d=b.targetTouches[0],e){if(f=a.getSelection(),f.rangeCount&&!f.isCollapsed)return!0;if(g=d.identifier,g&&isFinite(j.lastTouchIdentifier)&&j.lastTouchIdentifier===g)return b.preventDefault(),!1;j.lastTouchIdentifier=g,j.updateScrollParent(c)}j.status="tapping",j.startTime=Date.now(),j.element=c,j.pageX=d.pageX,j.pageY=d.pageY,j.startTime-j.lastTime<j.tapDelay&&b.preventDefault()},touchmove:function(a){return"tapping"!==j.status?!0:((j.element!==j.fixTarget(a.target)||j.touchHasMoved(a))&&(j.status=j.element=0),void 0)},touchend:function(b){var h,i,k,l,c=j.element,g=Date.now();if(!c||g-j.startTime>j.tapDelay)return!0;if(j.lastTime=g,h=j.startTime,j.status=j.startTime=0,i=c.tagName.toLowerCase(),"label"===i)f.fire(c,"tap",{touchEvent:b}),k=j.findControl(c),k&&(j.focus(c),c=k);else if(j.needFocus(c))return g-h>100||e&&a.top!==a&&"input"===i?(j.element=0,!1):(j.focus(c),d&&j.sendClick(c,b),!1);return e&&(l=c.tapScrollParent,l&&l.lastScrollTop!==l.scrollTop)?!0:(j.needClick(c)||(b.preventDefault(),j.sendClick(c,b)),void 0)},touchcancel:function(){j.startTime=j.element=0}},f.add("tap",j),k={events:["longtap","doubletap"],cancelPress:function(a){clearTimeout(a.pressingHandler),a.pressingHandler=null},touchstart:function(a){f.start(a,function(b,c){b.pressingHandler=setTimeout(function(){"tapping"===b.status&&f.fire(a.target,"longtap",{touch:c,touchEvent:a}),k.cancelPress(b)},500),1!==a.changedTouches.length&&(b.status=0)})},touchmove:function(a){f.move(a,function(a){a.distance>10&&a.pressingHandler&&(k.cancelPress(a),"tapping"===a.status&&(a.status="panning"))})},touchend:function(a){f.end(a,function(b,c){k.cancelPress(b),"tapping"===b.status&&(b.lastTime=Date.now(),k.lastTap&&b.lastTime-k.lastTap.lastTime<300&&f.fire(b.element,"doubletap",{touch:c,touchEvent:a}),k.lastTap=b)})},touchcancel:function(a){f.end(a,function(a){k.cancelPress(a)})}},f.add("press",k),l={events:["swipe","swipeleft","swiperight","swipeup","swipedown"],getAngle:function(a,b){return 180*Math.atan2(b,a)/Math.PI},getDirection:function(a,b){var c=l.getAngle(a,b);return-45>c&&c>-135?"up":c>=45&&315>c?"down":c>-45&&45>=c?"right":"left"},touchstart:function(a){f.start(a,y)},touchmove:function(a){f.move(a,y)},touchend:function(a){1===a.changedTouches.length&&f.end(a,function(b,c){var e,g,d=b.distance>30&&b.distance/b.duration>.65;d&&(e={deltaX:b.deltaX,deltaY:b.deltaY,touch:c,touchEvent:a,direction:l.getDirection(b.deltaX,b.deltaY),isVertical:b.isVertical},g=b.element,f.fire(g,"swipe",e),f.fire(g,"swipe"+e.direction,e))})}},l.touchcancel=l.touchend,f.add("swipe",l)},"function"==typeof define&&define.amd&&define("avalon",[],function(){return avalon}),Hd=a.avalon,avalon.noConflict=function(b){return b&&a.avalon===avalon&&(a.avalon=Hd),avalon},void 0===b&&(a.avalon=avalon),avalon});